# Remember - Personal Relationship Manager (PRM)

A mobile application to help users remember details about friends and family.

## Tech Stack

### Frontend (`frontend/`)
- **Framework**: Expo Router v5 with React Native 0.79
- **Language**: TypeScript 5.8
- **Styling**: Nativewind v4 (TailwindCSS for React Native)
- **State Management**: TanStack React Query v5
- **Forms**: React Hook Form + Zod validation
- **Authentication**: Clerk (`@clerk/clerk-expo`)
- **UI Components**: RN Primitives (ShadCN-style) + Lucide icons

### Backend (`server/`)
- **Framework**: Gin v1.11
- **Language**: Go 1.24
- **ORM**: Ent v0.14
- **Database**: PostgreSQL
- **Authentication**: Clerk SDK v2
- **Hot Reload**: Air

---

## Project Structure

### Frontend
```
frontend/src/
├── api/api.ts              # API functions (fetch-based)
├── app/                    # Expo Router pages (file-based routing)
│   ├── _layout.tsx         # Root layout (providers)
│   ├── index.tsx           # Entry redirect based on auth
│   ├── global.css          # Tailwind CSS variables
│   ├── (auth)/             # Unauthenticated routes
│   │   ├── sign-in.tsx
│   │   └── sign-up.tsx
│   └── (tabs)/             # Authenticated tab navigation
│       ├── index.tsx       # Home/connections list
│       ├── add-connection/
│       └── settings/
├── components/
│   ├── auth/               # Sign-in/up forms, social auth
│   ├── layout/             # Navigation components
│   └── ui/                 # Reusable UI (button, card, input, etc.)
├── hooks/                  # useConnections, useWorkspaces
├── lib/utils.ts            # cn() utility (clsx + tailwind-merge)
└── types/connections.ts    # TypeScript interfaces
```

### Backend
```
server/
├── cmd/
│   ├── main.go             # Server setup, route definitions
│   ├── middleware.go       # Auth middleware (Clerk JWT)
│   ├── connections.go      # Connection CRUD handlers
│   ├── workspaces.go       # Workspace handlers
│   ├── notes.go            # Note handlers
│   └── tags.go             # Tag handlers
└── ent/
    ├── schema/             # Entity definitions (edit these)
    │   ├── workspace.go
    │   ├── connection.go
    │   ├── note.go
    │   └── tag.go
    └── [generated]         # Auto-generated by `go generate ./ent`
```

---

## Database Schema

```
Workspace (1) ──< Connection (1) ──< Note
                      │
                      └──< Tag
```

- **Workspace**: `id`, `name`, `owner_user_id` (Clerk user ID)
- **Connection**: `id`, `workspace_id`, `name`, `image_url`
- **Note**: `id`, `connection_id`, `content`
- **Tag**: `id`, `connection_id`, `name`, `value`

---

## API Endpoints

All routes except `/test` require Bearer token authentication.

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/test` | Health check (no auth) |
| GET | `/workspaces` | List user workspaces |
| GET | `/workspaces/:workspace_id/connections` | List connections |
| POST | `/workspaces/:workspace_id/connections` | Create connection |
| POST | `/connections/:connection_id/notes` | Add note |
| GET | `/connections/:connection_id/notes` | List notes |
| PUT | `/notes/:note_id` | Update note |
| DELETE | `/notes/:note_id` | Delete note |
| POST | `/connections/:connection_id/tags` | Add tag |
| GET | `/connections/:connection_id/tags` | List tags |
| PUT | `/tags/:tag_id` | Update tag |
| DELETE | `/tags/:tag_id` | Delete tag |

---

## Code Patterns

### Frontend

**API calls** (fetch with Clerk token):
```typescript
const res = await fetch(`${process.env.EXPO_PUBLIC_BASE_API_URL}/endpoint`, {
  method: "POST",
  headers: {
    Authorization: `Bearer ${token}`,
    "Content-Type": "application/json",
  },
  body: JSON.stringify(data),
});
```

**React Query hooks**:
```typescript
const { data, isLoading } = useQuery({
  queryKey: ["connections"],
  queryFn: getConnections,
});

const mutation = useMutation({
  mutationFn: createConnectionApi,
});
```

**Styling with Nativewind**:
```tsx
<View className="flex-1 flex-col items-center px-6 pt-16">
<Pressable className={cn(buttonVariants({ variant, size }), className)} />
```

**Component variants** (class-variance-authority):
```typescript
const buttonVariants = cva('base-classes', {
  variants: {
    variant: { default: '...', destructive: '...' },
    size: { default: '...', sm: '...', lg: '...' },
  },
  defaultVariants: { variant: 'default', size: 'default' },
});
```

### Backend

**Handler factory pattern**:
```go
func GetConnections(client *ent.Client) gin.HandlerFunc {
  return func(c *gin.Context) {
    // Parse params, verify auth, query DB, return JSON
  }
}
```

**Request binding**:
```go
type CreateConnectionRequest struct {
  Name string `json:"name" binding:"required"`
}
var body CreateConnectionRequest
if err := c.ShouldBindJSON(&body); err != nil { ... }
```

**Error responses**:
```go
c.JSON(http.StatusBadRequest, gin.H{"error": "invalid id"})
c.JSON(http.StatusUnauthorized, gin.H{"error": "unauthorized"})
```

---

## Development Commands

### Start everything
```bash
docker compose up -d          # Backend + Postgres
cd frontend && npx expo start # Frontend
```

### Regenerate Ent code (after schema changes)
```bash
cd server && go generate ./ent
```

### Build backend
```bash
cd server && make build
```

---

## Environment Variables

### Frontend (`frontend/.env`)
```env
EXPO_PUBLIC_BASE_API_URL=http://<local-ip>:4444
EXPO_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
```

### Backend (`server/.env`)
```env
POSTGRES_ENT_CONN_STRING=postgres://user:pass@localhost:5555/remember?sslmode=disable
CLERK_SECRET_KEY=sk_test_...
```

---

## Key Files Reference

| Purpose | File |
|---------|------|
| Route definitions | `server/cmd/main.go` |
| Auth middleware | `server/cmd/middleware.go` |
| DB schemas | `server/ent/schema/*.go` |
| Frontend routes | `frontend/src/app/**/_layout.tsx` |
| API functions | `frontend/src/api/api.ts` |
| Types | `frontend/src/types/connections.ts` |
| Custom hooks | `frontend/src/hooks/*.ts` |
| UI components | `frontend/src/components/ui/*.tsx` |
| Tailwind config | `frontend/tailwind.config.js` |
| CSS variables | `frontend/src/app/global.css` |

---

## Conventions

- **Frontend components**: PascalCase files in `components/`, kebab-case for route files
- **Path aliases**: `~/` and `@/` both map to `src/`
- **Auth flow**: Clerk handles JWT, middleware validates on every request
- **Workspaces**: Auto-created on first request if none exist
- **Ent queries**: Always use `.WithNotes().WithTags()` when fetching connections to eager-load relations
